api.lady-lines.com {
  tls /root/deploy-clouldflare-caddy/certs/api.lady-lines.com.crt /root/deploy-clouldflare-caddy/certs/api.lady-lines.com.key
    root * /usr/share/caddy

      # 反向代理 V2Ray WebSocket 流量
    reverse_proxy /cc {
        to localhost:10086
    }

  file_server

}

api.findata-be.uk {
  tls /root/deploy-clouldflare-caddy/certs/api.findata-be.uk.crt /root/deploy-clouldflare-caddy/certs/api.findata-be.uk.key
 
  # Handle specific path first
  handle /vless {
    reverse_proxy localhost:56631
  }

  # Handle all other paths (default proxy)
  handle {
    reverse_proxy localhost:2053
  }

  # Log directive - if you want access logs, put it here, or use the global log directive
  # For access logs specifically for this site, you can put it inside the handle blocks
  # Or use a global log directive outside of any site block:
  # log {
  #   output file ./caddy_access.log
  # }
  # If you want to use it as a simple general logger for the site (which is less common in Caddyfile),
  # ensure its not conflicting with other directives.
  # For now, lets remove it from this location as its causing parsing issues.
  # log ./caddy.log # This line is likely the problem on line 61 or related to it.

}

prefect.findata-be.uk {
  tls /root/deploy-clouldflare-caddy/certs/prefect.findata-be.uk.crt /root/deploy-clouldflare-caddy/certs/prefect.findata-be.uk.key

  # Static files for /link_artifact/
  handle_path /link_artifact/* {
      root * /root/finance-tools-mcp/data
      file_server
  }

  reverse_proxy localhost:4200
}


stripe.findata-be.uk {
  tls /root/deploy-clouldflare-caddy/certs/stripe.findata-be.uk.crt /root/deploy-clouldflare-caddy/certs/stripe.findata-be.uk.key
  reverse_proxy localhost:8000
}


chat.findata-be.uk {
    # Provide your own TLS certificate and key
    tls /root/deploy-clouldflare-caddy/certs/chat.findata-be.uk.crt /root/deploy-clouldflare-caddy/certs/chat.findata-be.uk.key

    # Handle API requests by proxying them to your backend
    # The trailing '*' is crucial to match paths like /api/users
    # The 'trusted_proxies' block tells Caddy to trust headers
    # from Cloudflare IP ranges.

    handle /api/* {
        reverse_proxy localhost:3001 {
            header_up X-Real-IP {http.request.remote.host}
        }
    }

    # Handle all other requests to serve your frontend application
    handle {
        root * /root/finance-tools-master/dist
        
        # This rewrite is the key for browser router support.
        # It tries the requested file first, and if not found, serves index.html.
        try_files {path} /index.html
        
        file_server
    }
}